@startuml

actor "User" as u
participant "DeadlineMonitor" as dm
participant "Deadline" as d
participant "HealthMonitor" as hm

u -> hm : Get DeadlineMonitor
hm --> u : DeadlineMonitor instance
u -> dm : Create Deadline
dm -> dm : Register deadline
dm --> u : Deadline instance

alt Deadline stopped before expiration

u -> d : Start
d --> u : Ok
hm -> dm : Check deadlines
note right : HealthMonitor does this in a background thread
dm --> hm : Ok
u -> d : Stop
d --> u : Ok
dm -> dm : Unregister deadline

else Deadline stopped after expiration

u -> d : Start
d --> u : Ok
hm -> dm : Check deadlines
note right : HealthMonitor does this in a background thread
dm -> dm : Deadline expired
dm --> hm : Failed
u -> d : Stop
d --> u : Error
dm -> dm : Unregister deadline

else Deadline stopped while disabled

u -> d : Start
d --> u : Ok
u -> dm : Disable
dm --> u : Ok
hm -> dm : Check deadlines
note right : HealthMonitor does this in a background thread
dm --> hm : Ok
note right : The DeadlineMonitor is disabled, the deadlines are paused and not checked
u -> d : Stop
d --> u : Ok
dm -> dm : Unregister deadline
u -> dm : Enable
dm --> u : Ok

else Deadline expired after enabled

u -> d : Start
d --> u : Ok
u -> dm : Disable
dm --> u : Ok
hm -> dm : Check deadlines
note right : HealthMonitor does this in a background thread
dm --> hm : Ok
note right : The DeadlineMonitor is disabled, the deadlines are paused and not checked
u -> dm : Enable
dm --> u : Ok
hm -> dm : Check deadlines
note right : HealthMonitor does this in a background thread
dm -> dm : Deadline expired
dm --> hm : Failed
u -> d : Stop
d --> u : Error
dm -> dm : Unregister deadline

end

@enduml
